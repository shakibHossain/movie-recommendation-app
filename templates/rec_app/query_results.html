{% extends "rec_app/base.html" %}

{% block content %}
<h2 align = Center>Movie Search Results for Keyword(s) - {{ search_term }}</h2><br>

<section id="gridSystem">
{% for movie,movieindx in movies %}
	<div class="row">
		<div class="span2">
        	<div class="well">
	           	<img id ="poster{{movieindx}}" height="150" width="150">
          	</div>
        </div>
        <div class="span8">
        	<div class="well">
        		<p><strong>Movie Title : </strong><span id="title{{movieindx}}"></span><br></p>
				<label>Release Date : <span id="released{{movieindx}}"></span> (<span id="country{{movieindx}}"></span>)</label>
            	<label>Rated : <span id="rated{{movieindx}}"></span> &nbsp|&nbsp Runtime : <span id="runtime{{movieindx}}"></span> &nbsp|&nbsp Genre : <span id="genre{{movieindx}}"></span></label>
            	<label>Actors : <span id="actors{{movieindx}}"></span></label>
            	<label>Director : <span id="director{{movieindx}}"></span></label>
            	<label>Plot : <span id="plot{{movieindx}}"></span></label>
            	<label>IMDB Rating : <span id="imdbrating{{movieindx}}"></span></label>
				<strong>Rate : </strong>
				{% for vote in rates %}
			    	<a href="{% url 'rate_movie'  %}?vote={{vote}}&movies={{movies}}&movie={{movie}}&movieindx={{movieindx}}" method="GET"> {{vote}} </a>
				{% endfor %}
          	</div>
        </div>

		{% block javascript %}
			<script src="/static/js/jquery.js"></script>
		  	<script>
			  	var movie_title_with_year = "{{ movie }}";
			  	console.log("here2", movie_title_with_year);
			  	var movie_title_with_trailing_whitespace = movie_title_with_year.split("("); 
			  	var movie_title_final = movie_title_with_trailing_whitespace[0].trim();
			  	url = 'http://www.omdbapi.com/?apikey=d6793999&t='+movie_title_final+'';
			  	if(movie_title_final != undefined && movie_title_final != "") {
			  		fetch(url)
						.then(response => response.json())
					  	.then(function (data) {
					  			console.log(data.Year);
					  			// document.write("<span>data.Year</span><br>")
					  			$('#title{{movieindx}}').html(data.Title);
					  			$('#year{{movieindx}}').html(data.Year);
					  			$('#country{{movieindx}}').html(data.Country);
					  			$('#rated{{movieindx}}').html(data.Rated);
					  			$('#released{{movieindx}}').html(data.Released);
					  			$('#genre{{movieindx}}').html(data.Genre);
					  			$('#runtime{{movieindx}}').html(data.Runtime);
					  			$('#director{{movieindx}}').html(data.Director);
					  			$('#actors{{movieindx}}').html(data.Actors);
					  			$('#plot{{movieindx}}').html(data.Plot);
					  			$('#imdbrating{{movieindx}}').html(data.imdbRating);
					  			$("#myimage").attr('src','img url');
					  			$('#poster{{movieindx}}').attr('src', data.Poster);
						    	
					    });
				}

		  	</script>
		{% endblock %}
	</div>
{% endfor %}
</section>

{% endblock content %}
